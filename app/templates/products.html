{% extends "base.html" %}

{% block title %}Products - {{ settings.site_name }}{% endblock %}

{% block content %}
<!-- Header Section -->
<section class="bg-gradient-to-r from-gray-900 to-gray-800 text-white py-20">
    <div class="max-w-7xl mx-auto px-4">
        <div class="text-center">
            <h1 class="text-5xl font-bold mb-6">Our Products</h1>
            <p class="text-xl text-gray-300 max-w-2xl mx-auto">
                Discover our curated collection of premium products.
            </p>
        </div>
    </div>
</section>

<!-- Main Products Section -->
<section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 flex flex-col lg:flex-row gap-8">

        <!-- Filters -->
        <div class="lg:w-1/4">
            <div class="bg-white rounded-2xl shadow-lg p-6 sticky top-24">

                <!-- Search -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Search</h3>
                    <form method="GET">
                        <input type="text" name="search" value="{{ search_query|default('') }}" placeholder="Search..."
                            class="w-full px-4 py-3 border rounded-xl">
                        <button type="submit" class="absolute right-3 top-3 text-gray-400 hover:text-primary-600">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>

                <!-- Categories -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Categories</h3>
                    <div class="space-y-2">
                        <a href="{{ url_for('main.products') }}"
                            class="block py-2 px-3 rounded-lg {{ 'bg-primary-100 text-primary-700' if not selected_category else 'text-gray-700' }}">
                            All Categories
                        </a>
                        {% for cat in categories %}
                        <a href="{{ url_for('main.products', category=cat.id, brand=selected_brand|default(''), search=search_query|default('')) }}"
                            class="block py-2 px-3 rounded-lg {{ 'bg-primary-100 text-primary-700' if selected_category==cat.id else 'text-gray-700' }}">
                            <div class="flex justify-between">
                                <span>{{ cat.name }}</span>
                                <span class="text-sm bg-gray-100 px-2 py-1 rounded-full">{{ cat.count }}</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <!-- Brands -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Brands</h3>
                    <div class="space-y-2">
                        <a href="{{ url_for('main.products') }}"
                            class="block py-2 px-3 rounded-lg {{ 'bg-primary-100 text-primary-700' if not selected_brand else 'text-gray-700' }}">
                            All Brands
                        </a>
                        {% for brand in brands %}
                        <a href="{{ url_for('main.products', brand=brand.id, category=selected_category|default(''), search=search_query|default('')) }}"
                            class="block py-2 px-3 rounded-lg {{ 'bg-primary-100 text-primary-700' if selected_brand==brand.id else 'text-gray-700' }}">
                            <div class="flex justify-between">
                                <span>{{ brand.name }}</span>
                                <span class="text-sm bg-gray-100 px-2 py-1 rounded-full">{{ brand.product_count
                                    }}</span>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>

        <!-- Products Grid -->
        <div class="lg:w-3/4">
            {% if products %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for p in products %}
                {% if p.slug %}
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">

                    <a href="{{ url_for('main.product_detail', slug=p.slug) }}">
                        <img src="{% if p.images %}{{ url_for('static', filename=p.images[0]) }}{% else %}https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80{% endif %}"
                            alt="{{ p.name }}" class="w-full h-64 object-cover">
                    </a>

                    <div class="p-6">
                        <a href="{{ url_for('main.product_detail', slug=p.slug) }}">
                            <h3 class="text-lg font-semibold mb-2 hover:text-primary-600">{{ p.name }}</h3>
                        </a>
                        <p class="text-gray-600 text-sm mb-2">{{ p.description }}</p>

                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-xl font-bold text-primary-600">${{ "%.2f"|format(p.price) }}</span>
                                {% if p.compare_price %}
                                <span class="line-through text-gray-500 ml-2">${{ "%.2f"|format(p.compare_price)
                                    }}</span>
                                {% endif %}
                            </div>
                            <button onclick="addToCart({{ p.id }})"
                                class="bg-primary-500 text-white px-4 py-2 rounded-xl">Add to Cart</button>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if total_pages > 1 %}
            <div class="flex justify-center mt-8 space-x-2">
                {% for page in range(1, total_pages + 1) %}
                {% if page == current_page %}
                <span class="px-4 py-2 bg-primary-500 text-white rounded">{{ page }}</span>
                {% else %}
                <a href="{{ url_for('main.products', page=page, category=selected_category, brand=selected_brand, search=search_query) }}"
                    class="px-4 py-2 border rounded">{{ page }}</a>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            {% else %}
            <div class="text-center p-12 bg-white rounded-2xl shadow-lg">
                <h3 class="text-2xl font-bold mb-4">No Products Found</h3>
                <p class="text-gray-600 mb-4">Try adjusting your filters or search terms.</p>
                <a href="{{ url_for('main.products') }}" class="px-6 py-3 bg-primary-500 text-white rounded-xl">Browse
                    All Products</a>
            </div>
            {% endif %}
        </div>

    </div>
</section>

<script>
    function updatePriceDisplay() {
        const minInput = document.querySelector('input[name="min_price"]');
        const maxInput = document.querySelector('input[name="max_price"]');
        // Optional: dynamically update labels if needed
    }

    function addToCart(productId) {
        console.log("Adding product ID", productId, "to cart");
        // Implement AJAX or redirect to add to cart
    }
</script>

{% endblock %}